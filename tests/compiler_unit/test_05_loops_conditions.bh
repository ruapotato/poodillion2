# Test 05: Loops and Conditions
# Tests: while loops, if statements, method calls in loops
# Expected output:
#   5
#   120
from lib.syscalls import *

class SimpleLexer:
    source: Ptr[uint8]
    pos: int32
    length: int32

def SimpleLexer_init(self: Ptr[SimpleLexer], src: Ptr[uint8]):
    self.source = src
    self.pos = 0
    self.length = strlen(src)

def SimpleLexer_current_char(self: Ptr[SimpleLexer]) -> int32:
    if self.pos >= self.length:
        return 0
    return cast[int32](self.source[self.pos])

def SimpleLexer_advance(self: Ptr[SimpleLexer]):
    self.pos = self.pos + 1

def SimpleLexer_skip_whitespace(self: Ptr[SimpleLexer]):
    while self.pos < self.length:
        ch: int32 = SimpleLexer_current_char(self)
        if ch != 32:  # space
            if ch != 9:  # tab
                break
        SimpleLexer_advance(self)

def main() -> int32:
    lexer: SimpleLexer
    src: Ptr[uint8] = "x = 1"
    SimpleLexer_init(addr(lexer), src)

    print_int(lexer.length)
    println("")

    SimpleLexer_skip_whitespace(addr(lexer))

    # Should still be at 'x' (pos 0), print its ASCII
    ch: int32 = SimpleLexer_current_char(addr(lexer))
    print_int(ch)
    println("")

    return 0
