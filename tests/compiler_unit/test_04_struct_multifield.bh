# Test 04: Struct with Multiple Fields
# Tests: multi-field struct, field access via pointer
# Expected output:
#   5
#   104
from lib.syscalls import *

class SimpleLexer:
    source: Ptr[uint8]
    pos: int32
    length: int32

def SimpleLexer_init(self: Ptr[SimpleLexer], src: Ptr[uint8]):
    self.source = src
    self.pos = 0
    self.length = strlen(src)

def SimpleLexer_current_char(self: Ptr[SimpleLexer]) -> int32:
    if self.pos >= self.length:
        return 0
    return cast[int32](self.source[self.pos])

def main() -> int32:
    lexer: SimpleLexer
    src: Ptr[uint8] = "hello"
    SimpleLexer_init(addr(lexer), src)

    # Print length
    print_int(lexer.length)
    println("")

    # Print first char (should be 'h' = 104)
    ch: int32 = SimpleLexer_current_char(addr(lexer))
    print_int(ch)
    println("")

    return 0
