# Test 30: Simple syscall test
extern def syscall3(num: int32, arg1: int32, arg2: int32, arg3: int32) -> int32

def main():
    # getpid syscall = 20
    # write syscall = 4

    print("Test getpid: ")
    pid: int32 = syscall3(20, 0, 0, 0)  # getpid actually takes no args, but syscall3 ignores extras

    # Print pid as decimal
    if pid > 0:
        buf: int32 = 0
        temp: int32 = pid
        digits: int32 = 0
        while temp > 0:
            buf = buf * 10 + (temp % 10)
            temp = temp / 10
            digits = digits + 1
        while digits > 0:
            d: int32 = 48 + (buf % 10)
            syscall3(4, 1, addr(d), 1)
            buf = buf / 10
            digits = digits - 1
        print(" OK\n")
    else:
        print("FAIL\n")
