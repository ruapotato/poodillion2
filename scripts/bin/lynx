#!/usr/bin/pooscript
# lynx - text-based web browser
# Connects to remote httpd servers over the network

# If no arguments, show default page from default server
if len(args) == 0:
    # Default: connect to cyberspace.net portal
    hostname = "bbs.cyberspace.net"
    url_path = "/"
else:
    url = args[0]

    # Parse URL format: hostname or hostname/path
    if '/' in url:
        parts = url.split('/', 1)
        hostname = parts[0]
        url_path = '/' + parts[1]
    else:
        hostname = url
        url_path = '/'

# Get network interface
net = process.get_network()
if not net:
    error("lynx: Network is unreachable")
    print("")
    print("No network interface available.")
    print("Make sure you're connected to the network.")
    exit(1)

# Build full URL for http_get
full_url = f"http://{hostname}{url_path}"

print(f"Connecting to {hostname}...")
print(f"Requesting: {url_path}")
print("")

# Use network HTTP GET
try:
    content = net.http_get(full_url)

    if not content:
        error(f"lynx: Unable to retrieve {hostname}{url_path}")
        print("")
        print(f"Failed to fetch content from {hostname}")
        print("")
        print("Possible reasons:")
        print("  - Host is unreachable")
        print("  - File does not exist")
        print("  - No HTTP server running")
        print("")
        print("Try:")
        print("  nmap <subnet>     - Scan for available hosts")
        print("  nmap <host>       - Check open ports")
        print("  ping <host>       - Check if host is alive")
        exit(1)

    # Display content
    print("═" * 70)
    print(f"LYNX - {hostname}{url_path}")
    print("═" * 70)
    print("")
    print(content)
    print("")
    print("═" * 70)
    print("[Q] Back | [H] Help")
    print("═" * 70)

except Exception as e:
    error(f"lynx: Connection failed: {e}")
    exit(1)

exit(0)
