#!/usr/bin/virtualscript
# cp - copy files

if len(args) < 2:
    error("cp: missing operand")
    exit(1)

source = args[0]
dest = args[1]

try:
    # Check if source exists
    source_info = vfs.stat(source)

    if source_info['is_dir']:
        error(f"cp: {source}: Is a directory (use -r for recursive copy)")
        exit(1)

    # Read source
    content = vfs.read(source)

    # Check if dest is a directory
    try:
        dest_info = vfs.stat(dest)
        if dest_info['is_dir']:
            # Copy into directory
            source_name = basename(source)
            dest = join_path(dest, source_name)
    except:
        pass  # Dest doesn't exist, that's fine

    # Create destination file
    mode = source_info['mode'] & 0o777
    vfs.create(dest, mode, content)

except RuntimeError as e:
    error(f"cp: {e}")
    exit(1)

exit(0)
