#!/usr/bin/pooscript
# chown - change file ownership

# Only root can chown
if process.uid != 0:
    error("chown: Operation not permitted")
    exit(1)

if len(args) < 2:
    error("chown: missing operand")
    exit(1)

owner_spec = args[0]
paths = args[1:]

# Parse owner:group or just owner
if ':' in owner_spec:
    owner_str, group_str = owner_spec.split(':', 1)
else:
    owner_str = owner_spec
    group_str = None

# Convert to UID/GID (simplified - just use numbers for now)
try:
    new_uid = int(owner_str)
    new_gid = int(group_str) if group_str else None

    for path in paths:
        try:
            info = vfs.stat(path)
            gid = new_gid if new_gid is not None else info['gid']
            vfs.chown(path, new_uid, gid)
        except:
            error(f"chown: {path}: No such file or directory")
            exit(1)

except ValueError:
    error(f"chown: invalid user: {owner_str}")
    exit(1)

exit(0)
