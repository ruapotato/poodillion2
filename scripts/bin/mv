#!/usr/bin/virtualscript
# mv - move/rename files

if len(args) < 2:
    error("mv: missing operand")
    exit(1)

source = args[0]
dest = args[1]

try:
    # Check if source exists
    source_info = vfs.stat(source)

    # Check if dest is a directory
    try:
        dest_info = vfs.stat(dest)
        if dest_info['is_dir']:
            # Move into directory
            source_name = basename(source)
            dest = join_path(dest, source_name)
    except:
        pass  # Dest doesn't exist, that's fine

    # For files, copy then delete
    if source_info['is_file']:
        content = vfs.read(source)
        mode = source_info['mode'] & 0o777
        vfs.create(dest, mode, content)
        vfs.unlink(source)
    else:
        error("mv: directory move not yet implemented")
        exit(1)

except RuntimeError as e:
    error(f"mv: {e}")
    exit(1)

exit(0)
