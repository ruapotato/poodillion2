; Generated by Mini-Nim Compiler
bits 32

extern syscall1
extern syscall2
extern syscall3

section .data
str_0: db "Error: cannot open directory", 10, "", 0
str_1: db "PSCH", 0

section .text
global _start

_start:
    call main
    ; Halt (infinite loop)
.halt:
    hlt
    jmp .halt
    
strlen:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, 0
    mov [ebp-4], eax
while_start0:
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz while_end1
    mov eax, [ebp-4]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-4], eax
    jmp while_start0
while_end1:
    mov eax, [ebp-4]
    jmp strlen_return
strlen_return:
    mov esp, ebp
    pop ebp
    ret
    
print_err:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, [ebp+8]
    push eax
    call strlen
    add esp, 4
    mov [ebp-4], eax
    mov eax, [ebp-4]
    push eax
    mov eax, [ebp+8]
    push eax
    mov eax, 2
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
print_err_return:
    mov esp, ebp
    pop ebp
    ret
    
main:
    push ebp
    mov ebp, esp
    sub esp, 73
    mov eax, 0
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov [ebp-4], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 32768
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-8], eax
    mov eax, [ebp-8]
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov eax, [ebp-4]
    mov [ebp-12], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 8192
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-16], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 24576
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-20], eax
    mov eax, 46
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-20]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, 0
    push eax
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-20]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, 0
    push eax
    mov eax, 0
    push eax
    mov eax, 65536
    mov ebx, eax
    pop eax
    or eax, ebx
    push eax
    mov eax, [ebp-20]
    push eax
    mov eax, 5
    push eax
    call syscall3
    add esp, 16
    mov [ebp-24], eax
    mov eax, [ebp-24]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz else3
    lea eax, [rel str_0]
    push eax
    call print_err
    add esp, 4
    mov eax, 1
    push eax
    mov eax, 1
    push eax
    call syscall1
    add esp, 8
    jmp endif2
else3:
endif2:
    mov eax, 0
    mov [ebp-28], eax
    mov eax, 0
    mov [ebp-32], eax
    mov eax, 8192
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, 220
    push eax
    call syscall3
    add esp, 16
    mov [ebp-36], eax
while_start4:
    mov eax, [ebp-36]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setg al
    movzx eax, al
    test eax, eax
    jz while_end5
    mov eax, 0
    mov [ebp-40], eax
while_start6:
    mov eax, [ebp-40]
    push eax
    mov eax, [ebp-36]
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz while_end7
    mov eax, [ebp-12]
    push eax
    mov eax, [ebp-40]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 16
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-44], eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-44]
    shl ebx, 1
    add eax, ebx
    movzx eax, word [eax]
    mov [ebp-48], eax
    mov eax, [ebp-40]
    push eax
    mov eax, 18
    mov ebx, eax
    pop eax
    add eax, ebx
    mov ebx, eax
    mov eax, [ebp-12]
    add eax, ebx
    movzx eax, byte [eax]
    mov byte [ebp-49], al
    mov eax, [ebp-12]
    push eax
    mov eax, [ebp-40]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 19
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-53], eax
    mov eax, 0
    mov [ebp-57], eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-53]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 46
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else9
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-53]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else11
    mov eax, 1
    mov [ebp-57], eax
    jmp endif10
else11:
endif10:
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-53]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 46
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else13
    mov eax, 2
    mov ebx, eax
    mov eax, [ebp-53]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else15
    mov eax, 1
    mov [ebp-57], eax
    jmp endif14
else15:
endif14:
    jmp endif12
else13:
endif12:
    jmp endif8
else9:
endif8:
    mov eax, [ebp-57]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else17
    mov eax, [ebp-16]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-61], eax
    mov eax, 0
    mov [ebp-65], eax
while_start18:
    mov eax, [ebp-65]
    push eax
    mov eax, 56
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz while_end19
    mov eax, 0
    push eax
    mov eax, [ebp-65]
    mov ebx, eax
    mov eax, [ebp-61]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, [ebp-65]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-65], eax
    jmp while_start18
while_end19:
    mov eax, [ebp-53]
    push eax
    call strlen
    add esp, 4
    mov [ebp-69], eax
    mov eax, [ebp-69]
    push eax
    mov eax, 52
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    sub eax, ebx
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setg al
    movzx eax, al
    test eax, eax
    jz else21
    mov eax, 52
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    sub eax, ebx
    mov [ebp-69], eax
    jmp endif20
else21:
endif20:
    mov eax, 0
    mov [ebp-65], eax
while_start22:
    mov eax, [ebp-65]
    push eax
    mov eax, [ebp-69]
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz while_end23
    mov eax, [ebp-65]
    mov ebx, eax
    mov eax, [ebp-53]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, [ebp-65]
    mov ebx, eax
    mov eax, [ebp-61]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, [ebp-65]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-65], eax
    jmp while_start22
while_end23:
    movzx eax, byte [ebp-49]
    push eax
    mov eax, 52
    mov ebx, eax
    mov eax, [ebp-61]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, [ebp-32]
    push eax
    mov eax, 56
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    mov eax, [ebp-28]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-28], eax
    jmp endif16
else17:
endif16:
    mov eax, [ebp-40]
    push eax
    mov eax, [ebp-48]
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-40], eax
    jmp while_start6
while_end7:
    mov eax, 8192
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, 220
    push eax
    call syscall3
    add esp, 16
    mov [ebp-36], eax
    jmp while_start4
while_end5:
    mov eax, [ebp-24]
    push eax
    mov eax, 6
    push eax
    call syscall1
    add esp, 8
    mov eax, 4
    push eax
    lea eax, [rel str_1]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, 1
    mov byte [ebp-70], al
    mov eax, 1
    push eax
    lea eax, [ebp-70]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, 2
    mov byte [ebp-71], al
    mov eax, 1
    push eax
    lea eax, [ebp-71]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, 56
    mov word [ebp-73], ax
    mov eax, 2
    push eax
    lea eax, [ebp-73]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, 4
    push eax
    lea eax, [ebp-28]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, [ebp-32]
    push eax
    mov eax, [ebp-16]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, 0
    push eax
    mov eax, 1
    push eax
    call syscall1
    add esp, 8
main_return:
    mov esp, ebp
    pop ebp
    ret
