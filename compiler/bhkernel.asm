; Generated by Brainhair Compiler
bits 32

extern syscall1
extern syscall2
extern syscall3

section .data
str_0: db "", 10, "", 0
str_1: db "bhkernel: exec failed", 10, "", 0
str_2: db "bhkernel - Brainhair Kernel Builder", 0
str_3: db "kernel/kernel.bh", 0
str_4: db "build/kernel.bin", 0
str_5: db "  [1/4] Compiling ", 0
str_6: db "...", 0
str_7: db "/usr/bin/python3", 0
str_8: db "compiler/brainhair.py", 0
str_9: db "--kernel", 0
str_10: db "--asm-only", 0
str_11: db "compiler/kernel.asm", 0
str_12: db "bhkernel: compilation failed", 10, "", 0
str_13: db "  [2/4] Assembling...", 0
str_14: db "/usr/bin/nasm", 0
str_15: db "-f", 0
str_16: db "elf32", 0
str_17: db "compiler/kernel.asm", 0
str_18: db "-o", 0
str_19: db "compiler/kernel.o", 0
str_20: db "bhkernel: assembly failed", 10, "", 0
str_21: db "  [3/4] Linking...", 0
str_22: db "/usr/bin/ld", 0
str_23: db "-m", 0
str_24: db "elf_i386", 0
str_25: db "-T", 0
str_26: db "boot/linker.ld", 0
str_27: db "-o", 0
str_28: db "build/kernel.elf", 0
str_29: db "compiler/kernel.o", 0
str_30: db "bhkernel: linking failed", 10, "", 0
str_31: db "  [4/4] Creating ", 0
str_32: db "...", 0
str_33: db "/usr/bin/objcopy", 0
str_34: db "-O", 0
str_35: db "binary", 0
str_36: db "build/kernel.elf", 0
str_37: db "bhkernel: objcopy failed", 10, "", 0
str_38: db "", 0
str_39: db "Kernel built: ", 0

section .text
global _start
global get_argc
global get_argv

section .bss
_startup_esp: resd 1

section .text

_start:
    mov [_startup_esp], esp  ; Save initial stack pointer
    call main
    ; Exit with return code from main
    mov ebx, eax  ; Exit code
    mov eax, 1    ; sys_exit
    int 0x80

; get_argc() - returns argument count
get_argc:
    mov eax, [_startup_esp]
    mov eax, [eax]  ; argc is at [esp]
    ret

; get_argv(index) - returns pointer to argument string
get_argv:
    push ebp
    mov ebp, esp
    mov eax, [_startup_esp]
    mov ecx, [ebp+8]  ; index
    lea eax, [eax + 4 + ecx*4]  ; argv[index] = esp + 4 + index*4
    mov eax, [eax]
    pop ebp
    ret
    
print:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, 0
    mov [ebp-4], eax
while_start0:
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz while_end1
    mov eax, [ebp-4]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-4], eax
    jmp while_start0
while_end1:
    mov eax, [ebp-4]
    push eax
    mov eax, [ebp+8]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
print_return:
    mov esp, ebp
    pop ebp
    ret
    
println:
    push ebp
    mov ebp, esp
    mov eax, [ebp+8]
    push eax
    call print
    add esp, 4
    mov eax, 1
    push eax
    lea eax, [rel str_0]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
println_return:
    mov esp, ebp
    pop ebp
    ret
    
print_err:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, 0
    mov [ebp-4], eax
while_start2:
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz while_end3
    mov eax, [ebp-4]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-4], eax
    jmp while_start2
while_end3:
    mov eax, [ebp-4]
    push eax
    mov eax, [ebp+8]
    push eax
    mov eax, 2
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
print_err_return:
    mov esp, ebp
    pop ebp
    ret
    
strlen:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, 0
    mov [ebp-4], eax
while_start4:
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz while_end5
    mov eax, [ebp-4]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-4], eax
    jmp while_start4
while_end5:
    mov eax, [ebp-4]
    jmp strlen_return
strlen_return:
    mov esp, ebp
    pop ebp
    ret
    
strcpy:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, 0
    mov [ebp-4], eax
while_start6:
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+12]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz while_end7
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+12]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, [ebp-4]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-4], eax
    jmp while_start6
while_end7:
    mov eax, 0
    push eax
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
strcpy_return:
    mov esp, ebp
    pop ebp
    ret
    
run_cmd:
    push ebp
    mov ebp, esp
    sub esp, 12
    mov eax, 0
    push eax
    mov eax, 2
    push eax
    call syscall1
    add esp, 8
    mov [ebp-4], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else9
    mov eax, 0
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-8]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    lea eax, [ebp-8]
    push eax
    mov eax, [ebp+8]
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp+8]
    shl ebx, 2
    add eax, ebx
    mov eax, [eax]
    push eax
    mov eax, 11
    push eax
    call syscall3
    add esp, 16
    lea eax, [rel str_1]
    push eax
    call print_err
    add esp, 4
    mov eax, 127
    push eax
    mov eax, 1
    push eax
    call syscall1
    add esp, 8
    jmp endif8
else9:
endif8:
    mov eax, [ebp-4]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz else11
    mov eax, 1
    jmp run_cmd_return
    jmp endif10
else11:
endif10:
    mov eax, 0
    mov [ebp-12], eax
    mov eax, 0
    push eax
    lea eax, [ebp-12]
    push eax
    mov eax, [ebp-4]
    push eax
    mov eax, 7
    push eax
    call syscall3
    add esp, 16
    mov eax, [ebp-12]
    push eax
    mov eax, 8
    mov ebx, eax
    pop eax
    mov ecx, ebx
    shr eax, cl
    push eax
    mov eax, 255
    mov ebx, eax
    pop eax
    and eax, ebx
    jmp run_cmd_return
run_cmd_return:
    mov esp, ebp
    pop ebp
    ret
    
run_cmd_stdout:
    push ebp
    mov ebp, esp
    sub esp, 16
    mov eax, 0
    push eax
    mov eax, 2
    push eax
    call syscall1
    add esp, 8
    mov [ebp-4], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else13
    mov eax, 420
    push eax
    mov eax, 1
    push eax
    mov eax, 64
    mov ebx, eax
    pop eax
    or eax, ebx
    push eax
    mov eax, 512
    mov ebx, eax
    pop eax
    or eax, ebx
    push eax
    mov eax, [ebp+12]
    push eax
    mov eax, 5
    push eax
    call syscall3
    add esp, 16
    mov [ebp-8], eax
    mov eax, [ebp-8]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setge al
    movzx eax, al
    test eax, eax
    jz else15
    mov eax, 1
    push eax
    mov eax, [ebp-8]
    push eax
    mov eax, 63
    push eax
    call syscall2
    add esp, 12
    mov eax, [ebp-8]
    push eax
    mov eax, 6
    push eax
    call syscall1
    add esp, 8
    jmp endif14
else15:
endif14:
    mov eax, 0
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-12]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    lea eax, [ebp-12]
    push eax
    mov eax, [ebp+8]
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp+8]
    shl ebx, 2
    add eax, ebx
    mov eax, [eax]
    push eax
    mov eax, 11
    push eax
    call syscall3
    add esp, 16
    mov eax, 127
    push eax
    mov eax, 1
    push eax
    call syscall1
    add esp, 8
    jmp endif12
else13:
endif12:
    mov eax, [ebp-4]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz else17
    mov eax, 1
    jmp run_cmd_stdout_return
    jmp endif16
else17:
endif16:
    mov eax, 0
    mov [ebp-16], eax
    mov eax, 0
    push eax
    lea eax, [ebp-16]
    push eax
    mov eax, [ebp-4]
    push eax
    mov eax, 7
    push eax
    call syscall3
    add esp, 16
    mov eax, [ebp-16]
    push eax
    mov eax, 8
    mov ebx, eax
    pop eax
    mov ecx, ebx
    shr eax, cl
    push eax
    mov eax, 255
    mov ebx, eax
    pop eax
    and eax, ebx
    jmp run_cmd_stdout_return
run_cmd_stdout_return:
    mov esp, ebp
    pop ebp
    ret
    
main:
    push ebp
    mov ebp, esp
    sub esp, 36
    call get_argc
    mov [ebp-4], eax
    lea eax, [rel str_2]
    push eax
    call println
    add esp, 4
    lea eax, [rel str_3]
    mov [ebp-8], eax
    lea eax, [rel str_4]
    mov [ebp-12], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 2
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setge al
    movzx eax, al
    test eax, eax
    jz else19
    mov eax, 1
    push eax
    call get_argv
    add esp, 4
    mov [ebp-8], eax
    jmp endif18
else19:
endif18:
    mov eax, [ebp-4]
    push eax
    mov eax, 3
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setge al
    movzx eax, al
    test eax, eax
    jz else21
    mov eax, 2
    push eax
    call get_argv
    add esp, 4
    mov [ebp-12], eax
    jmp endif20
else21:
endif20:
    mov eax, 0
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov [ebp-16], eax
    mov eax, [ebp-16]
    push eax
    mov eax, 8192
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-20], eax
    mov eax, [ebp-20]
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov eax, [ebp-16]
    mov [ebp-24], eax
    mov eax, [ebp-16]
    push eax
    mov eax, 4096
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-28], eax
    lea eax, [rel str_5]
    push eax
    call print
    add esp, 4
    mov eax, [ebp-8]
    push eax
    call print
    add esp, 4
    lea eax, [rel str_6]
    push eax
    call println
    add esp, 4
    mov eax, 0
    mov [ebp-32], eax
    lea eax, [rel str_7]
    push eax
    mov eax, [ebp-24]
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 20
    mov [ebp-32], eax
    lea eax, [rel str_8]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 24
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    mov eax, [ebp-8]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 2
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, [ebp-8]
    push eax
    call strlen
    add esp, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_9]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 3
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 12
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_10]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 4
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 0
    push eax
    mov eax, 5
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    lea eax, [rel str_11]
    push eax
    mov eax, [ebp-28]
    push eax
    call run_cmd_stdout
    add esp, 8
    mov [ebp-36], eax
    mov eax, [ebp-36]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz else23
    lea eax, [rel str_12]
    push eax
    call print_err
    add esp, 4
    mov eax, 1
    jmp main_return
    jmp endif22
else23:
endif22:
    lea eax, [rel str_13]
    push eax
    call println
    add esp, 4
    mov eax, 0
    mov [ebp-32], eax
    lea eax, [rel str_14]
    push eax
    mov eax, [ebp-24]
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 16
    mov [ebp-32], eax
    lea eax, [rel str_15]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_16]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 2
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 8
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_17]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 3
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 24
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_18]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 4
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_19]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 5
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 0
    push eax
    mov eax, 6
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-28]
    push eax
    call run_cmd
    add esp, 4
    mov [ebp-36], eax
    mov eax, [ebp-36]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz else25
    lea eax, [rel str_20]
    push eax
    call print_err
    add esp, 4
    mov eax, 1
    jmp main_return
    jmp endif24
else25:
endif24:
    lea eax, [rel str_21]
    push eax
    call println
    add esp, 4
    mov eax, 0
    mov [ebp-32], eax
    lea eax, [rel str_22]
    push eax
    mov eax, [ebp-24]
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 16
    mov [ebp-32], eax
    lea eax, [rel str_23]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_24]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 2
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 12
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_25]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 3
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_26]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 4
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 20
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_27]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 5
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_28]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 6
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 20
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_29]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 7
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 0
    push eax
    mov eax, 8
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-28]
    push eax
    call run_cmd
    add esp, 4
    mov [ebp-36], eax
    mov eax, [ebp-36]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz else27
    lea eax, [rel str_30]
    push eax
    call print_err
    add esp, 4
    mov eax, 1
    jmp main_return
    jmp endif26
else27:
endif26:
    lea eax, [rel str_31]
    push eax
    call print
    add esp, 4
    mov eax, [ebp-12]
    push eax
    call print
    add esp, 4
    lea eax, [rel str_32]
    push eax
    call println
    add esp, 4
    mov eax, 0
    mov [ebp-32], eax
    lea eax, [rel str_33]
    push eax
    mov eax, [ebp-24]
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 20
    mov [ebp-32], eax
    lea eax, [rel str_34]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 1
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_35]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 2
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 8
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    lea eax, [rel str_36]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 3
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-32]
    push eax
    mov eax, 20
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-32], eax
    mov eax, [ebp-12]
    push eax
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    call strcpy
    add esp, 8
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 4
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, 0
    push eax
    mov eax, 5
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    pop ebx
    mov [eax], ebx
    mov eax, [ebp-28]
    push eax
    call run_cmd
    add esp, 4
    mov [ebp-36], eax
    mov eax, [ebp-36]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz else29
    lea eax, [rel str_37]
    push eax
    call print_err
    add esp, 4
    mov eax, 1
    jmp main_return
    jmp endif28
else29:
endif28:
    lea eax, [rel str_38]
    push eax
    call println
    add esp, 4
    lea eax, [rel str_39]
    push eax
    call print
    add esp, 4
    mov eax, [ebp-12]
    push eax
    call println
    add esp, 4
    mov eax, 0
    jmp main_return
main_return:
    mov esp, ebp
    pop ebp
    ret
