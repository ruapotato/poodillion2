; Generated by Mini-Nim Compiler
bits 32

extern syscall1
extern syscall3

section .data
str_0: db "0", 0
str_1: db "Error: No schema header", 10, "", 0
str_2: db "Record count: ", 0
str_3: db "", 10, "", 0

section .text
global _start

_start:
    call main
    ; Halt (infinite loop)
.halt:
    hlt
    jmp .halt
    
print:
    push ebp
    mov ebp, esp
    sub esp, 4
    mov eax, 0
    mov [ebp-4], eax
while_start0:
    mov eax, [ebp-4]
    mov ebx, eax
    mov eax, [ebp+8]
    add eax, ebx
    movzx eax, byte [eax]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz while_end1
    mov eax, [ebp-4]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-4], eax
    jmp while_start0
while_end1:
    mov eax, [ebp-4]
    push eax
    mov eax, [ebp+8]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
print_return:
    mov esp, ebp
    pop ebp
    ret
    
print_number:
    push ebp
    mov ebp, esp
    sub esp, 28
    mov eax, [ebp+8]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    sete al
    movzx eax, al
    test eax, eax
    jz else3
    mov eax, 1
    push eax
    lea eax, [rel str_0]
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    jmp print_number_return
    jmp endif2
else3:
endif2:
    mov eax, 0
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov [ebp-4], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 32
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-8], eax
    mov eax, [ebp-8]
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov eax, [ebp-4]
    mov [ebp-12], eax
    mov eax, [ebp+8]
    mov [ebp-16], eax
    mov eax, 0
    mov [ebp-20], eax
while_start4:
    mov eax, [ebp-16]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setg al
    movzx eax, al
    test eax, eax
    jz while_end5
    mov eax, [ebp-16]
    push eax
    mov eax, 10
    mov ebx, eax
    pop eax
    xor edx, edx
    idiv ebx
    mov eax, edx
    mov [ebp-24], eax
    mov eax, 48
    push eax
    mov eax, [ebp-24]
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, [ebp-20]
    mov ebx, eax
    mov eax, [ebp-12]
    add eax, ebx
    pop ebx
    mov byte [eax], bl
    mov eax, [ebp-20]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-20], eax
    mov eax, [ebp-16]
    push eax
    mov eax, 10
    mov ebx, eax
    pop eax
    xor edx, edx
    idiv ebx
    mov [ebp-16], eax
    jmp while_start4
while_end5:
    mov eax, [ebp-20]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    sub eax, ebx
    mov [ebp-28], eax
while_start6:
    mov eax, [ebp-28]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setge al
    movzx eax, al
    test eax, eax
    jz while_end7
    mov eax, 1
    push eax
    mov eax, [ebp-28]
    mov ebx, eax
    mov eax, [ebp-12]
    add eax, ebx
    push eax
    mov eax, 1
    push eax
    mov eax, 4
    push eax
    call syscall3
    add esp, 16
    mov eax, [ebp-28]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    sub eax, ebx
    mov [ebp-28], eax
    jmp while_start6
while_end7:
print_number_return:
    mov esp, ebp
    pop ebp
    ret
    
main:
    push ebp
    mov ebp, esp
    sub esp, 40
    mov eax, 0
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov [ebp-4], eax
    mov eax, [ebp-4]
    push eax
    mov eax, 8192
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-8], eax
    mov eax, [ebp-8]
    push eax
    mov eax, 45
    push eax
    call syscall1
    add esp, 8
    mov eax, [ebp-4]
    mov [ebp-12], eax
    mov eax, 4
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, 0
    push eax
    mov eax, 3
    push eax
    call syscall3
    add esp, 16
    mov [ebp-16], eax
    mov eax, [ebp-16]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setne al
    movzx eax, al
    test eax, eax
    jz else9
    lea eax, [rel str_1]
    push eax
    call print
    add esp, 4
    mov eax, 1
    push eax
    mov eax, 1
    push eax
    call syscall1
    add esp, 8
    jmp endif8
else9:
endif8:
    mov eax, 1
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, 4
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 0
    push eax
    mov eax, 3
    push eax
    call syscall3
    add esp, 16
    mov [ebp-16], eax
    mov eax, 1
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, 5
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 0
    push eax
    mov eax, 3
    push eax
    call syscall3
    add esp, 16
    mov [ebp-16], eax
    mov eax, 2
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, 6
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 0
    push eax
    mov eax, 3
    push eax
    call syscall3
    add esp, 16
    mov [ebp-16], eax
    mov eax, [ebp-12]
    push eax
    mov eax, 6
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-20], eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-20]
    shl ebx, 1
    add eax, ebx
    movzx eax, word [eax]
    mov [ebp-24], eax
    mov eax, 4
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, 8
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 0
    push eax
    mov eax, 3
    push eax
    call syscall3
    add esp, 16
    mov [ebp-16], eax
    mov eax, [ebp-12]
    push eax
    mov eax, 8
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-28], eax
    mov eax, 0
    mov ebx, eax
    mov eax, [ebp-28]
    shl ebx, 2
    add eax, ebx
    mov eax, [eax]
    mov [ebp-32], eax
    mov eax, 0
    mov [ebp-36], eax
    mov eax, 0
    mov [ebp-40], eax
while_start10:
    mov eax, [ebp-40]
    push eax
    mov eax, [ebp-32]
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setl al
    movzx eax, al
    test eax, eax
    jz while_end11
    mov eax, [ebp-24]
    push eax
    mov eax, [ebp-12]
    push eax
    mov eax, 12
    mov ebx, eax
    pop eax
    add eax, ebx
    push eax
    mov eax, 0
    push eax
    mov eax, 3
    push eax
    call syscall3
    add esp, 16
    mov [ebp-16], eax
    mov eax, [ebp-16]
    push eax
    mov eax, 0
    mov ebx, eax
    pop eax
    cmp eax, ebx
    setg al
    movzx eax, al
    test eax, eax
    jz else13
    mov eax, [ebp-36]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-36], eax
    jmp endif12
else13:
endif12:
    mov eax, [ebp-40]
    push eax
    mov eax, 1
    mov ebx, eax
    pop eax
    add eax, ebx
    mov [ebp-40], eax
    jmp while_start10
while_end11:
    lea eax, [rel str_2]
    push eax
    call print
    add esp, 4
    mov eax, [ebp-36]
    push eax
    call print_number
    add esp, 4
    lea eax, [rel str_3]
    push eax
    call print
    add esp, 4
    mov eax, 0
    push eax
    mov eax, 1
    push eax
    call syscall1
    add esp, 8
main_return:
    mov esp, ebp
    pop ebp
    ret
